<script src="https://integrate.thrive.today"></script>

<!-- If customer logged in -->
{% if customer %}
  {% assign order_total = 0 %}
  {% assign orders_count = 0 %}
  {% for order in customer.orders %}
    {% assign order_total = order_total | plus: order.total_price %}
    {% assign orders_count = orders_count | plus: 1 %}
  {% endfor %}
  <script>
    var customer_logged_in = true;
    var customer_id = {{customer.id}};
    var order_total = {{order_total}};
    var orders_count = {{orders_count}};
  </script>

  {% if orders_count > 0 %}
    <script>
      var order_average = order_total / {{orders_count}};
    </script>
  {% else %}
    <script>
      var order_average = 0;
    </script>
  {% endif %}
{% else %}
<!-- If guest -->
  <script>
    var customer_logged_in = false;
    var customer_id = false;
    var order_total = 0;
    var orders_count = 0;
    var order_average = 0;
  </script>
{% endif %}

<script type="text/javascript">
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '/cart.js');
  xhr.onload = function() {
      if (xhr.status === 200) {
        JSON.parse(xhr.response);
      }
      else {
        console.log(xhr.status);
      }
  };
  xhr.send();
</script>

<!-- Regardless of login or not get cart. -->
<script>
  var total_price = {{cart.total_price}};
  var item_count = {{cart.item_count}};
  var gte_object = {
    "gte_class_name" : "minird_shopify_cart",
    "total_price" : total_price,
    "item_count" : item_count,
    "customer_logged_in" : customer_logged_in,
    "order_total" : order_total,
    "orders_count" : orders_count,
    "order_average" : order_average,
    "customer_id" : customer_id
  };
  console.log(gte_object);
  thrive.gte( gte_object["gte_class_name"], gte_object );
  thrive.gte_send();
</script>
